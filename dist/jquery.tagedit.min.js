/** License:* This work is licensed under a MIT License* http://www.opensource.org/licenses/mit-license.php */
!function(a){a.fn.autoGrowInput=function(b){return b=a.extend({maxWidth:1e3,minWidth:0,comfortZone:70},b),this.filter("input:text").each(function(){var c=b.minWidth||a(this).width(),d="",e=a(this),f=a("<tester/>").css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:e.css("fontSize"),fontFamily:e.css("fontFamily"),fontWeight:e.css("fontWeight"),letterSpacing:e.css("letterSpacing"),whiteSpace:"nowrap"}),g=function(){if(d!==(d=e.val())){var a=d.replace(/&/g,"&amp;").replace(/\s/g,"&nbsp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");f.html(a);var g=f.width(),h=g+b.comfortZone>=c?g+b.comfortZone:c,i=e.width(),j=i>h&&h>=c||h>c&&h<b.maxWidth;j&&e.width(h)}};f.insertAfter(e),a(this).bind("keyup keydown blur update",g),g()}),this}}(jQuery),function(a){a.fn.tagedit=function(b){function c(c){if(0!=b.allowEdit){var e="SPAN"==c.target.tagName?a(c.target).parent():a(c.target),f=null;e.on("finishEdit",function(c,e){window.clearTimeout(f);var g=a(this).find(":text"),h=g.val(),i=d(h,!0),k=i[0],l=i[1];return h.length>0&&("undefined"==typeof e||e===!1)&&1==k?(a(this).find('input[type="hidden"]').val(h),a(this).find("span").html(h)):h.length>0&&l&&(a(this).find('input[type="hidden"]').val(h).attr("name",j+"["+l+"]"),a(this).find("span").html(h),a(this).attr("data-tagedit-fromdb",!0)),g.remove(),a(this).find("a.tagedit-save, a.tagedit-break").remove(),a(this).removeClass("tagedit-listelement-edit").off("finishEdit"),b.beforeAppend(a(this),l,h,j),!1});var g=e.find(":hidden");html='<input type="text" name="tmpinput" autocomplete="off" value="'+g.val()+'" class="tagedit-edit-input" dir="'+b.direction+'"/>',html+='<a class="tagedit-save" title="'+b.texts.saveEditLinkTitle+'">o</a>',html+='<a class="tagedit-break" title="'+b.texts.breakEditLinkTitle+'">x</a>',g.after(html),e.addClass("tagedit-listelement-edit").find("a.tagedit-save").click(function(){return a(this).parent().trigger("finishEdit"),!1}).end().find("a.tagedit-break").click(function(){return a(this).parent().trigger("finishEdit",[!0]),!1}).end().find(":text").focus().autoGrowInput({comfortZone:10,minWidth:15,maxWidth:2e4}).keypress(function(b){switch(b.keyCode){case 13:return b.preventDefault(),a(this).parent().trigger("finishEdit"),!1;case 27:return b.preventDefault(),a(this).parent().trigger("finishEdit",[!0]),!1}return!0}).blur(function(){var b=a(this);f=window.setTimeout(function(){b.parent().trigger("finishEdit",[!0])},500)})}}function d(c,d){d="undefined"==typeof d?!1:d;var g=null,h=c,i=!0;if(l.find("li.tagedit-listelement-old input:hidden").each(function(){this.value==h&&(i=!1)}),1==i&&1==d&&0!=b.autocompleteOptions.source){var j=[];if(a.isArray(b.autocompleteOptions.source))j=b.autocompleteOptions.source;else if(a.isFunction(b.autocompleteOptions.source))b.autocompleteOptions.source({term:c},function(a){j=a});else if("string"==typeof b.autocompleteOptions.source){var k=f(c);if(k===!1)j=[];else if(k)j=[{value:k.value,id:k.id}];else{var m=b.autocompleteOptions.source;m+=m.match(/\?/)?"&":"?",m+="term="+c,a.ajax({url:m,dataType:"json",async:!1}).done(function(a,b,c){j=a;for(var d in j)e[j[d].value]=j[d]})}}for(var n=0;n<j.length;n++){var o=j[n].value;if(o==h){i=!1,g=j[n].id;break}}}return[i,g]}var e={};b=a.extend(!0,{checkToDeleteURL:null,additionalListClass:"",allowEdit:!0,direction:"ltr",autocompleteOptions:{select:function(b,c){return a(this).val(c.item.value).trigger("transformToTag",[c.item.id]),!1},response:function(a,b){b.content.forEach(function(a){e[a.value]=a})}},cacheRequests:!0,breakKeyCodes:[13,44],texts:{removeLinkTitle:"Remove from list.",saveEditLinkTitle:"Save changes.",deleteLinkTitle:"Delete this tag from database.",deleteConfirmation:"Are you sure to delete this entry?",deletedElementTitle:"This Element will be deleted.",breakEditLinkTitle:"Cancel",forceDeleteConfirmation:"There are more records using this tag, are you sure do you want to remove it?"},tabindex:!1,maxTags:-1,beforeSave:function(a){return a},beforeRemove:function(a){return!0},beforeAppend:function(a,b,c,d){return a},rejectCallback:function(a){}},b||{});var f=function(a){return b.cacheRequests&&a in e?e[a]:null};if(0!=this.length){var g=this.attr("dir");g&&g.length>0&&(b.direction=this.attr("dir"));var h=this,i=new RegExp("^(.*)\\[([0-9]*?)?]$","i"),j=h.eq(0).attr("name").match(i);if(!j||3!=j.length)return void alert("elementname dows not match the expected format (regexp: "+i+")");j=j[1];var k,l=a();return!b.tabindex&&(k=h.eq(0).attr("tabindex"))&&(b.tabindex=k),function(){var g=a('<ul class="tagedit-list '+b.additionalListClass+'">');h.each(function(){var c=a(this).attr("name").match(i);if(c&&3==c.length&&(0==b.deleteEmptyItems||a(this).val().length>0)&&c[1].length>0){var d="undefined"!=typeof c[2]?c[2]:"",e=this.value,f='<li class="tagedit-listelement tagedit-listelement-old" data-tagedit-fromdb="true" >';f+='<span dir="'+b.direction+'">'+e+"</span>",f+='<input type="hidden" name="'+j+"["+d+']" value="'+e+'" />',f+='<a class="tagedit-close" title="'+b.texts.removeLinkTitle+'">x</a>',f+="</li>",g.append(b.beforeAppend(a(f),d,e,j))}}),h.last().after(g),l=h.last().next(),h.remove(),g='<li class="tagedit-listelement tagedit-listelement-new">',g+='<input type="text" name="'+j+'[]" value="" disabled="disabled" class="tagedit-input tagedit-input-disabled" dir="'+b.direction+'"/>',g+="</li>",g+="</ul>",l.append(g).attr("tabindex",b.tabindex).focus(function(b){a(this).click()}).find(".tagedit-input").attr("tabindex",b.tabindex).each(function(){if(a(this).autoGrowInput({comfortZone:15,minWidth:15,maxWidth:2e4}),a(this).on("transformToTag",function(c,e){var f="undefined"!=typeof e&&(e.length>0||e>0),g=1==f?!1:!0,h=d(a(this).val(),g),i=h[0],k=h[1];if((i===!0||i===!1&&k>0)&&(0==f&&k>0&&(f=!0,e=k),0!==b.maxTags||f))if(b.maxTags>0&&l.find("li.tagedit-listelement-old").length>=b.maxTags)b.rejectCallback("maxTags");else{var m=this.value,n=b.beforeSave(m);if(n){var o=f?j+"["+e+"]":j+"[]",p='<li class="tagedit-listelement tagedit-listelement-old" data-tagedit-fromdb="'+(f?"true":"false")+'" >';p+='<span dir="'+b.direction+'">'+n+"</span>",p+='<input type="hidden" name="'+o+'" value="'+n+'"/>',p+='<a class="tagedit-close" title="'+b.texts.removeLinkTitle+'">x</a>',p+="</li>";var q=b.beforeAppend(a(p),e,n,j);a(this.parentNode).before(q)}else b.rejectCallback("beforeSave",m)}a(this).val(""),b.autocompleteOptions.source&&a(this).autocomplete("close")}).keydown(function(c){var d=c.keyCode>0?c.keyCode:c.which;switch(d){case 8:if(0==a(this).val().length){var e=l.find("li.tagedit-listelement-old");return b.beforeRemove(e)&&l.find("li.tagedit-listelement-old").last().remove(),c.preventDefault(),!1}break;case 9:if(a(this).val().length>0&&0==a("ul.ui-autocomplete #ui-active-menuitem").length)return a(this).trigger("transformToTag"),c.preventDefault(),!1}return!0}).keypress(function(c){var d=c.keyCode>0?c.keyCode:c.which;return a.inArray(d,b.breakKeyCodes)>-1?(a(this).val().length>0&&0==a("ul.ui-autocomplete #ui-active-menuitem").length&&a(this).trigger("transformToTag"),c.preventDefault(),!1):!0}).on("paste",function(b){var c=a(this);"paste"==b.type&&setTimeout(function(){c.trigger("transformToTag")},1)}).on("blur",function(){0!==this.value.length&&a(this).trigger("transformToTag"),a(this).attr("disabled","disabled").addClass("tagedit-input-disabled")}),b.autocompleteOptions.source)if("string"==typeof b.autocompleteOptions.source){var c=b.autocompleteOptions.source;b.autocompleteOptions.source=function(b,d){var g=b.term;f(g)===!1?d([]):a.ajax({url:c,data:{term:g}}).done(function(a){!a.length||1===a.length&&0===a[0].length?(e[g]=!1,d([])):(a.forEach(function(a){e[a.value]=a}),d(a))})},a(this).autocomplete(b.autocompleteOptions),b.autocompleteOptions=c}else a(this).autocomplete(b.autocompleteOptions)}).end().click(function(d){switch(d.target.tagName){case"A":var e=a(d.target).parent();b.beforeRemove(e)&&e.remove(),a(this).find(".tagedit-input").click();break;case"INPUT":case"SPAN":case"LI":if(0==a(d.target).hasClass("tagedit-listelement-deleted")&&0==a(d.target).parent("li").hasClass("tagedit-listelement-deleted"))return c(d);default:a(this).find(".tagedit-input").removeAttr("disabled").removeClass("tagedit-input-disabled").focus()}return!1})}(),l}}}(jQuery);